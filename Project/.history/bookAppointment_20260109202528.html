<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book an Appointment</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

</head>
<body class="bg-light">

<div class="container mt-5 p-4 bg-white shadow rounded" style="max-width: 600px;">
    <h1 class="text-center text-primary mb-3">Book an Appointment</h1>
    <p class="text-center text-muted">Please fill out the form below to book your appointment.</p>

    <form id="appointmentForm">

        <div class="mb-3">
            <label for="patientName" class="form-label fw-bold">Patient Name:</label>
            <input type="text" pattern="[A-Za-z\s]+" class="form-control" id="patientName" name="patientName" required>
        </div>
         <div class="mb-3">
            <label for="patientName" class="form-label fw-bold">Patient Name:</label>
            <input type="text" pattern="[A-Za-z\s]+" class="form-control" id="patientName" name="patientName" required>
        </div>

        <div class="mb-3">
            <label class="form-label fw-bold">Hospital Name:</label>
            <select class="form-control" id="hospitalDropdown" name="hospitalName" required>
                <option value="">Select Hospital</option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label fw-bold">Doctor Name:</label>
            <select class="form-control" id="doctorDropdown" name="hospitalName" required>
                <option value="">Select Doctor</option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label fw-bold">Appointment Date:</label>
            <input type="date" class="form-control" id="appointmentDate" name="appointmentDate" required>
        </div>

        <div class="mb-3">
            <label class="form-label fw-bold">Appointment Time:</label>
            <input type="time" class="form-control" id="appointmentTime" name="appointmentTime" required>
        </div>

        <div class="d-grid mt-4">
            <button type="submit" class="btn btn-primary btn-lg">Book Appointment</button>
        </div>

    </form>
</div>

<script>
/* -------------------- LOAD HOSPITALS -------------------- */
function populateHospitals() {
    const hospitalDropdown = document.getElementById("hospitalDropdown");

    fetch("http://localhost:8080/hospital")
        .then(response => response.json())
        .then(hospitals => {
            hospitalDropdown.innerHTML = '<option value="">Select Hospital</option>';

            hospitals.forEach(hospital => {
                const option = document.createElement("option");
                option.value = hospital.id;
                option.textContent = hospital.name;
                hospitalDropdown.appendChild(option);
            });
        })
        .catch(error => {
            console.error("Error loading hospitals:", error);
            hospitalDropdown.innerHTML = '<option value="">Failed to load hospitals</option>';
        });
}

document.addEventListener("DOMContentLoaded", populateHospitals);


/* -------------------- LOAD DOCTORS BASED ON HOSPITAL -------------------- */
document.getElementById("hospitalDropdown").addEventListener("change", function () {
    const hospitalId = this.value;
    populateDoctors(hospitalId);
});

function populateDoctors(hospitalId) {
    const doctorDropdown = document.getElementById("doctorDropdown");
    doctorDropdown.innerHTML = '<option>Loading...</option>';

    fetch(`http://localhost:8080/doctors/byHospital/${hospitalId}`)
        .then(response => response.json())
        .then(doctors => {
            doctorDropdown.innerHTML = '<option value="">Select Doctor</option>';

            doctors.forEach(doctor => {
                const option = document.createElement("option");
                option.value = doctor.name;
                option.textContent = doctor.name;
                doctorDropdown.appendChild(option);
            });
        })
        .catch(error => {
            console.error("Error loading doctors:", error);
            doctorDropdown.innerHTML = '<option value="">Failed to load doctors</option>';
        });
}


/* -------------------- FORM SUBMIT -------------------- */
document.getElementById("appointmentForm").addEventListener("submit", function (event) {
    event.preventDefault();

    const appointmentData = {
        patientName: document.getElementById("patientName").value,
        hospitalId: document.getElementById("hospitalDropdown").value,
        doctorName: document.getElementById("doctorDropdown").value,
        appointmentDate: document.getElementById("appointmentDate").value,
        appointmentTime: document.getElementById("appointmentTime").value
    };

    fetch("http://localhost:8080/appointments/bookAppointment", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(appointmentData)
    })
    .then(response => response.json())
    .then(data => {
        alert("Appointment Successful!");
        document.getElementById("appointmentForm").reset();
    })
    .catch(error => {
        alert("Something went wrong: " + error.message);
    });
});
</script>

</body>
</html>
