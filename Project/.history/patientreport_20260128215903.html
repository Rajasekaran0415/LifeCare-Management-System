<!DOCTYPE html>
<html>
<head>
Â  Â  <title>Patient Report</title>
Â  Â  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<div class="container mt-5 p-4 bg-white shadow rounded" style="max-width: 600px;">

Â  Â  <h2 class="text-center text-primary mb-4">Patient Report</h2>

Â  Â  <p class="text-center text-muted">
Â  Â  Â  Â  Click the button below to download your medical report.
Â  Â  </p>

Â  Â  <div class="d-grid mt-4">
        Â  Â  Â  Â  <button class="btn btn-success btn-lg" onclick="downloadReport(currentPatientId)">
Â  Â  Â  Â  Â  Â  Download Patient Report (PDF)
Â  Â  Â  Â  </button>
Â  Â  </div>

</div>

<script>
// ðŸ’¡ IMPORTANT: This variable must be defined and updated after a successful login API call.
let currentPatientId = 0; // Replace '13' with the dynamically logged-in patient's ID
currentPatientId++;

/* -------------------- Download Patient Report as PDF -------------------- */
function downloadReport(patientid) {
Â  Â  // 1. Check if a valid ID was passed
Â  Â  if (!patientid || patientid === 0) {
Â  Â  Â  Â  alert("Error: Patient ID is missing or invalid. Please log in.");
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  // 2. Fetch the report using the patientid in a template literal URL
Â  Â  fetch(`http://localhost:8080/patients/report/${patientid}`, {
Â  Â  Â  Â  method: "GET"
Â  Â  })
Â  Â  .then(response => {
Â  Â  Â  Â  if (!response.ok) {

Â  Â  Â  Â  Â  Â  throw new Error(`Server returned: ${response.status} ${response.statusText || 'Error'}`);
Â  Â  Â  Â  }
Â  Â  Â  Â  return response.blob(); 
Â  Â  })
Â  Â  .then(blob => {

Â  Â  Â  Â  const fileURL = window.URL.createObjectURL(blob);

Â  Â  Â  Â  const a = document.createElement("a");
Â  Â  Â  Â  a.href = fileURL;
Â  Â  Â  Â  
Â  Â  Â  Â  a.download = `Patient_Report_${patientid}.pdf`; 
Â  Â  Â  Â  
        document.body.appendChild(a);
Â  Â  Â  Â  a.click(); Â 
Â  Â  Â  Â  
       
Â  Â  Â  Â  window.URL.revokeObjectURL(fileURL);
Â  Â  Â  Â  a.remove();
Â  Â  })
Â  Â  .catch(error => {
Â  Â  Â  Â  console.error("Error downloading report:", error);
Â  Â  Â  Â  alert(`Failed to download report: ${error.message}. Please check if the patient ID exists on the server.`);
Â  Â  });
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>